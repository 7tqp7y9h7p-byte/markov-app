<!DOCTYPE html>
<html lang="et">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Markov Ennustaja</title>

<style>
body{font-family:-apple-system;background:#020617;color:white;padding:14px}
.btn-row{display:flex;gap:8px}
.btn-row button{flex:1;padding:18px;font-size:26px;border-radius:14px;border:none;color:white}
.btn-0{background:#16a34a}.btn-1{background:#2563eb}.btn-2{background:#f59e0b}.btn-3{background:#dc2626}
.card{background:#0f172a;padding:14px;border-radius:14px;margin-top:12px}
.big{font-size:34px;font-weight:bold;text-align:center}
.small{font-size:13px;opacity:.7;text-align:center}
.grid{display:grid;grid-template-columns:repeat(5,1fr);gap:6px}
input{padding:6px;border-radius:6px;border:none}
.active{outline:2px solid #22c55e}
table{width:100%;font-size:12px}
td,th{text-align:center;padding:4px}
.green{color:#22c55e}.red{color:#ef4444}
</style>
</head>

<body>

<h2>ğŸ“Š Markov Ennustaja</h2>

<div class="btn-row">
<button class="btn-0" onclick="inputNum(0)">0</button>
<button class="btn-1" onclick="inputNum(1)">1</button>
<button class="btn-2" onclick="inputNum(2)">2</button>
<button class="btn-3" onclick="inputNum(3)">3</button>
</div>

<div class="card">
<div class="small">ğŸ”® JÃ„RGMINE ENNUSTUS</div>
<div class="big" id="pred">â€”</div>
</div>

<div class="card">
<div class="small">âš–ï¸ KAALUD</div>
Markov <input type="range" min="0" max="200" value="100" id="wM"><br>
Sagedus <input type="range" min="0" max="200" value="60" id="wF"><br>
Trend <input type="range" min="0" max="200" value="40" id="wT">
</div>

<div class="card">
<div class="small">âœï¸ MANUAALSED PANUSED</div>
<div class="grid" id="betGrid"></div>
</div>

<div class="card">
Bankroll: <b id="bankroll">1000</b><br>
Panuseid: <b id="bets">0</b><br>
Aste: <b id="step">1</b>
</div>

<div class="card">
<b>ğŸ“œ AJALUGU</b>
<table id="history"></table>
</div>

<script>
function $(i){return document.getElementById(i)}

let state=JSON.parse(localStorage.getItem("mk"))||{
hist:[],trans:{},last:null,bank:1000,bets:0,
manual:Array(20).fill(1),idx:0,log:[]
}

function save(){localStorage.setItem("mk",JSON.stringify(state))}

function markovKey(){
return state.hist.length>=2
? state.hist[state.hist.length-2]+","+state.hist[state.hist.length-1]
: null
}

function markovPredict(){
let k=markovKey(),r=state.trans[k]
if(!r)return null
let best=null,max=-1
for(let n in r){if(r[n]>max){max=r[n];best=+n}}
return best
}

function freqPredict(){
let c=[0,0,0,0]
state.hist.forEach(n=>c[n]++)
let m=Math.max(...c)
return m?c.indexOf(m):null
}

function trendPredict(){
if(state.hist.length<2)return null
let a=state.hist[state.hist.length-1]
let b=state.hist[state.hist.length-2]
return a===b ? (a+1)%4 : a
}

function combinedPredict(){
let v=[0,0,0,0]
let wm=wM.value/100,wf=wF.value/100,wt=wT.value/100
let m=markovPredict(); if(m!==null)v[m]+=wm
let f=freqPredict();   if(f!==null)v[f]+=wf
let t=trendPredict();  if(t!==null)v[t]+=wt
return v.indexOf(Math.max(...v))
}

function inputNum(n){
let bet=state.manual[state.idx]

if(state.last!==null){
state.bets++
let win=n===state.last
state.bank += win ? bet*2 : -bet
state.idx = win ? 0 : Math.min(19,state.idx+1)
state.log.unshift({p:state.last,r:n,b:bet,w:win,br:state.bank})
if(state.log.length>500)state.log.pop()
}

let k=markovKey()
if(k){
state.trans[k]=state.trans[k]||{}
state.trans[k][n]=(state.trans[k][n]||0)+1
}

state.hist.push(n)
if(state.hist.length>3)state.hist.shift()

state.last=combinedPredict()
save();ui()
}

function ui(){
pred.innerHTML=state.last??"â€”"
bankroll.innerHTML=state.bank
bets.innerHTML=state.bets
step.innerHTML=state.idx+1

let g=betGrid
if(!g.children.length){
for(let i=0;i<20;i++){
let inp=document.createElement("input")
inp.type="number"
inp.value=state.manual[i]
inp.oninput=()=>{state.manual[i]=+inp.value||0;save()}
g.appendChild(inp)
}
}
[...g.children].forEach((x,i)=>x.className=i===state.idx?"active":"")
history.innerHTML="<tr><th>#</th><th>P</th><th>R</th><th>B</th><th>BR</th></tr>"+
state.log.map((x,i)=>`<tr class='${x.w?"green":"red"}'><td>${state.log.length-i}</td><td>${x.p}</td><td>${x.w?"W":"L"}</td><td>${x.b}</td><td>${x.br}</td></tr>`).join("")
}

ui()
</script>
</body>
</html>