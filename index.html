<!DOCTYPE html>
<html lang="et">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Markov Ennustaja</title>

<style>
body{
 font-family:-apple-system,system-ui;
 background:#020617;
 color:white;
 padding:16px;
}
button{
 width:22%;
 padding:16px;
 font-size:22px;
 margin:1%;
 border-radius:12px;
 border:none;
 background:#2563eb;
 color:white;
}
.reset{
 background:#dc2626;
 width:100%;
 margin-top:10px;
}
.card{
 background:#0f172a;
 padding:16px;
 border-radius:14px;
 margin-top:14px;
}
.big{
 font-size:36px;
 font-weight:bold;
 text-align:center;
}
.small{
 opacity:.7;
 font-size:13px;
 text-align:center;
}
.green{color:#22c55e}
.red{color:#ef4444}
.yellow{color:#eab308}
table{width:100%;font-size:12px}
td,th{padding:4px;text-align:center}
</style>
</head>

<body>

<h2>ğŸ“Š Markov Ennustaja</h2>

<div>
<button onclick="inputNum(0)">0</button>
<button onclick="inputNum(1)">1</button>
<button onclick="inputNum(2)">2</button>
<button onclick="inputNum(3)">3</button>
</div>

<button class="reset" onclick="resetSession()">ğŸ”„ RESET</button>

<div class="card">
 <div class="small">ğŸ”® JÃ„RGMINE ENNUSTUS</div>
 <div class="big" id="pred">â€”</div>
 <div class="small" id="conf">Confidence â€”</div>
</div>

<div class="card">
 <div class="small">ğŸ’° JÃ„RGMINE PANUS</div>
 <div class="big" id="bet">â€”</div>
</div>

<div class="card">
 <div class="small">ğŸ¦ BANKROLL</div>
 <div class="big" id="bank">0</div>
</div>

<div class="card">
 <div>Vajutusi: <b id="clicks">0</b></div>
 <div>Panuseid: <b id="bets">0</b></div>
</div>

<div class="card">
 <b>ğŸ“œ Panuste ajalugu</b>
 <table id="history"></table>
</div>

<script>
/* ---------- UTIL ---------- */
function $(id){ return document.getElementById(id); }

/* ---------- STATE ---------- */
var state = JSON.parse(localStorage.getItem("mk_state")) || {
 history:[],
 transitions:{},
 lastPrediction:null,
 bankroll:1000,
 miss:0,
 clicks:0,
 bets:0,
 betHistory:[]
};

var betsTable=[1,2,4,8,16,32,64,128,256,512];

/* ---------- LOGIC ---------- */
function markovKey(){
 if(state.history.length<2) return null;
 return state.history.slice(-2).join(",");
}

function predict(){
 var k=markovKey();
 if(!k) return null;
 var r=state.transitions[k];
 if(!r) return null;

 var best=null,max=-1;
 for(var n in r){
  if(r[n]>max){
   max=r[n];
   best=n;
  }
 }
 return best!==null?parseInt(best):null;
}

function confidence(){
 var k=markovKey();
 if(!k) return null;
 var r=state.transitions[k];
 if(!r) return null;

 var sum=0,max=0;
 for(var n in r){
  sum+=r[n];
  if(r[n]>max) max=r[n];
 }
 if(sum===0) return null;
 return Math.round(max/sum*100);
}

function currentBet(){
 return betsTable[Math.min(state.miss,betsTable.length-1)];
}

/* ---------- INPUT ---------- */
function inputNum(n){
 state.clicks++;

 var bet=currentBet();

 if(state.lastPrediction!==null){
  state.bets++;
  var win=(state.lastPrediction===n);

  if(win){
   state.bankroll+=bet*2;
   state.miss=0;
  }else{
   state.bankroll-=bet;
   state.miss++;
  }

  state.betHistory.unshift({
   p:state.lastPrediction,
   r:n,
   b:bet,
   w:win,
   br:state.bankroll
  });
  if(state.betHistory.length>50)
   state.betHistory.pop();
 }

 if(state.history.length>=2){
  var k=markovKey();
  if(!state.transitions[k]) state.transitions[k]={};
  state.transitions[k][n]=(state.transitions[k][n]||0)+1;
 }

 state.history.push(n);
 if(state.history.length>3) state.history.shift();

 state.lastPrediction=predict();
 save();
 updateUI();
}

/* ---------- UI ---------- */
function updateUI(){
 $("pred").innerText = state.lastPrediction!==null ? state.lastPrediction : "â€”";

 var c=confidence();
 if(c===null){
  $("conf").innerText="Confidence â€”";
  $("conf").className="small";
 }else{
  $("conf").innerText="Confidence "+c+"%";
  $("conf").className="small "+(c>=60?"green":c>=40?"yellow":"red");
 }

 $("bet").innerText=currentBet();
 $("bank").innerText=state.bankroll.toFixed(2);
 $("clicks").innerText=state.clicks;
 $("bets").innerText=state.bets;

 var html="<tr><th>#</th><th>Enn</th><th>Tulemus</th><th>Panus</th><th>BR</th></tr>";
 for(var i=0;i<state.betHistory.length;i++){
  var h=state.betHistory[i];
  html+="<tr class='"+(h.w?"green":"red")+"'>"+
        "<td>"+(state.betHistory.length-i)+"</td>"+
        "<td>"+h.p+" â†’ "+h.r+"</td>"+
        "<td>"+(h.w?"WIN":"LOSS")+"</td>"+
        "<td>"+h.b+"</td>"+
        "<td>"+h.br.toFixed(2)+"</td></tr>";
 }
 $("history").innerHTML=html;
}

/* ---------- RESET ---------- */
function resetSession(){
 state.history=[];
 state.transitions={};
 state.lastPrediction=null;
 state.miss=0;
 state.clicks=0;
 state.bets=0;
 state.betHistory=[];
 save();
 updateUI();
}

/* ---------- STORAGE ---------- */
function save(){
 localStorage.setItem("mk_state",JSON.stringify(state));
}

/* ---------- INIT ---------- */
document.addEventListener("DOMContentLoaded",updateUI);
</script>

</body>
</html>