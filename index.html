<!DOCTYPE html>
<html lang="et">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Markov Ennustaja</title>

<style>
body{font-family:-apple-system;background:#020617;color:white;padding:16px}
button{width:22%;padding:16px;font-size:22px;margin:1%;border-radius:12px;border:none;background:#2563eb;color:white}
.reset{background:#dc2626;width:100%;margin-top:10px}
.card{background:#0f172a;padding:16px;border-radius:14px;margin-top:14px}
.big{font-size:36px;font-weight:bold;text-align:center}
.small{opacity:.7;font-size:13px;text-align:center}
.green{color:#22c55e}
.red{color:#ef4444}
.yellow{color:#eab308}
input,select{width:100%;margin-top:4px}
table{width:100%;font-size:12px}
td,th{padding:4px;text-align:center}
.active{background:#1d4ed8}
</style>
</head>

<body>

<h2>ğŸ“Š Markov Ennustaja</h2>

<div>
<button onclick="inputNum(0)">0</button>
<button onclick="inputNum(1)">1</button>
<button onclick="inputNum(2)">2</button>
<button onclick="inputNum(3)">3</button>
</div>

<button class="reset" onclick="resetSession()">ğŸ”„ RESET (session)</button>

<div class="card">
 <div class="small">ğŸ”® JÃ„RGMINE ENNUSTUS</div>
 <div class="big" id="pred">â€”</div>
 <div id="confEl" class="small">Confidence â€”</div>
</div>

<div class="card">
 <div class="small">ğŸ’° JÃ„RGMINE PANUS</div>
 <div class="big" id="bet">â€”</div>
</div>

<div class="card">
 <div class="small">ğŸ¦ BANKROLL</div>
 <div class="big" id="bank">â€”</div>
</div>

<div class="card">
 <div class="small">ğŸ“ˆ LOENDURID</div>
 <div>Vajutusi: <b id="clicks">0</b></div>
 <div>Panuseid: <b id="betsCount">0</b></div>
</div>

<div class="card">
<b>âš™ï¸ Seaded</b>
<label>Algne bankroll</label>
<input id="startBank" type="number" value="1000">

<label>Panustamise reÅ¾iim</label>
<select id="betMode">
 <option value="manual">MANUAL</option>
 <option value="martingale">MARTINGALE</option>
 <option value="fibonacci">FIBONACCI</option>
</select>

<label>Markovi jÃ¤rk</label>
<select id="markovOrder">
 <option value="2">2</option>
 <option value="3">3</option>
</select>
</div>

<div class="card">
<b>ğŸ“œ Panuste ajalugu</b>
<table id="historyTable"></table>
</div>

<script>
var fib=[1,1];
for(var i=2;i<20;i++) fib[i]=fib[i-1]+fib[i-2];

var state=JSON.parse(localStorage.getItem("mk_state")) || {
 history:[],
 transitions:{},
 lastPrediction:null,
 bankroll:1000,
 miss:0,
 clicks:0,
 betsPlaced:0,
 bets:[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288],
 betHistory:[]
};

function markovKey(){
 var k=parseInt(markovOrder.value);
 return state.history.slice(-k).join(",");
}

function getConfidence(){
 var r=state.transitions[markovKey()];
 if(!r) return null;
 var vals=Object.values(r);
 if(vals.length===0) return null;
 var sum=0;
 for(var i=0;i<vals.length;i++) sum+=vals[i];
 var max=Math.max.apply(null,vals);
 return Math.round(max/sum*100);
}

function predict(){
 var r=state.transitions[markovKey()];
 if(!r) return null;
 var keys=Object.keys(r);
 if(keys.length===0) return null;
 var best=keys[0];
 for(var i=1;i<keys.length;i++){
  if(r[keys[i]]>r[best]) best=keys[i];
 }
 return parseInt(best);
}

function currentBet(){
 if(betMode.value==="fibonacci")
  return fib[Math.min(state.miss,19)];
 return state.bets[Math.min(state.miss,19)];
}

function inputNum(n){
 state.clicks++;
 var bet=currentBet();

 if(state.lastPrediction!==null){
  state.betsPlaced++;
  var win=(state.lastPrediction===n);

  if(win){
   state.bankroll+=bet*2;
   state.miss=0;
  }else{
   state.bankroll-=bet;
   state.miss++;
  }

  state.betHistory.unshift({
   prediction:state.lastPrediction,
   input:n,
   bet:bet,
   result:win?"WIN":"LOSS",
   bankroll:state.bankroll
  });

  if(state.betHistory.length>50)
   state.betHistory.pop();
 }

 if(state.history.length>=parseInt(markovOrder.value)){
  var k=markovKey();
  if(!state.transitions[k]) state.transitions[k]={};
  state.transitions[k][n]=(state.transitions[k][n]||0)+1;
 }

 state.history.push(n);
 if(state.history.length>3) state.history.shift();

 state.lastPrediction=predict();
 save();
 updateUI();
}

function updateUI(){
 var c=getConfidence();
 pred.innerText=(state.lastPrediction!==null?state.lastPrediction:"â€”");

 if(c===null){
  confEl.innerText="Confidence â€”";
  confEl.className="small";
 }else{
  confEl.innerText="Confidence "+c+"%";
  confEl.className="small "+(c>=60?"green":c>=40?"yellow":"red");
 }

 bet.innerText=currentBet();
 bank.innerText=state.bankroll.toFixed(2);
 clicks.innerText=state.clicks;
 betsCount.innerText=state.betsPlaced;

 historyTable.innerHTML=
 "<tr><th>#</th><th>Enn</th><th>Tulemus</th><th>Panus</th><th>BR</th></tr>"+
 state.betHistory.map(function(h,i){
  return "<tr class='"+(h.result==="WIN"?"green":"red")+"'>"+
   "<td>"+(state.betHistory.length-i)+"</td>"+
   "<td>"+h.prediction+" â†’ "+h.input+"</td>"+
   "<td>"+h.result+"</td>"+
   "<td>"+h.bet+"</td>"+
   "<td>"+h.bankroll.toFixed(2)+"</td></tr>";
 }).join("");
}

function resetSession(){
 state.history=[];
 state.transitions={};
 state.lastPrediction=null;
 state.bankroll=parseFloat(startBank.value);
 state.miss=0;
 state.clicks=0;
 state.betsPlaced=0;
 save();
 updateUI();
}

function save(){
 localStorage.setItem("mk_state",JSON.stringify(state));
}

updateUI();
</script>
</body>
</html>