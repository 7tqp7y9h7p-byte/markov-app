<!DOCTYPE html>
<html lang="et">
<head><link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#020617">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Markov PRO">
<link rel="apple-touch-icon" href="icon-192.png">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Markovi Ennustaja PRO</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{font-family:-apple-system;background:#020617;color:white;padding:14px}
h1{text-align:center}
button{width:22%;padding:14px;font-size:22px;margin:1%;border-radius:12px;border:none;background:#2563eb;color:white}
.full{width:100%}
.reset{background:#dc2626}
.card{background:#0f172a;padding:14px;border-radius:14px;margin-top:14px}
.big{text-align:center;background:linear-gradient(135deg,#1d4ed8,#2563eb)}
.prediction{background:linear-gradient(135deg,#047857,#16a34a)}
.amount{font-size:56px;font-weight:bold}
.small{font-size:13px;opacity:.8}
input,select{width:100%;margin:4px 0}
table{width:100%} td{font-size:13px;padding:3px}
.green{color:#22c55e} .yellow{color:#eab308} .red{color:#ef4444}
</style>
</head>

<body>

<h1>ğŸ“Š Markovi Ennustaja PRO</h1>

<div>
<button onclick="inputNum(0)">0</button>
<button onclick="inputNum(1)">1</button>
<button onclick="inputNum(2)">2</button>
<button onclick="inputNum(3)">3</button>
</div>

<button class="full reset" onclick="resetAll()">ğŸ”„ Reset</button>

<div class="card big prediction">
<div class="small">ğŸ”® JÃ„RGMINE ENNUSTUS</div>
<div class="amount" id="nextPrediction">â€”</div>
<div class="small" id="confidence">Confidence â€”</div>
</div>

<div class="card big">
<div class="small">ğŸ’° JÃ„RGMINE PANUS</div>
<div class="amount" id="nextBet">â€”</div>
<div class="small" id="betReason"></div>
</div>

<div class="card big">
<div class="small">ğŸ¦ BANKROLL</div>
<div class="amount" id="bankroll">â€”</div>
<div class="small" id="roi"></div>
</div>

<div class="card">
<b>âš™ï¸ Seaded</b>
<label>Min confidence %</label>
<input id="confLimit" type="number" value="45">
<label>Algne bankroll</label>
<input id="startBank" type="number" value="1000">
<label>PanustamisreÅ¾iim</label>
<select id="betMode" onchange="updateUI()">
<option value="custom">Custom</option>
<option value="martingale">Martingale</option>
<option value="fibonacci">Fibonacci</option>
</select>
<label>Baaspandus (M/F)</label>
<input id="baseBet" type="number" value="10">
</div>

<div class="card" id="customTable">
<b>ğŸ“‹ Custom panused</b>
<table id="betTable"></table>
</div>

<div class="card">
<b>ğŸ“ˆ TÃ¤psus</b>
<canvas id="chartAcc"></canvas>
</div>

<div class="card">
<b>ğŸ’° Bankrolli graafik</b>
<canvas id="chartBank"></canvas>
</div>

<script>
let state=JSON.parse(localStorage.getItem("mkv"))||{
 history:[],transitions:{},miss:0,lastPrediction:null,
 total:0,correct:0,timeline:[],bankroll:1000,
 invested:0,bankrollHistory:[],
 bets:Array.from({length:20},(_,i)=>2**i)
};

const fib=[1,1,2,3,5,8,13,21,34,55,89,144,233,377,610,987,1597,2584,4181,6765];

function confidence(){
 if(state.history.length<2)return null;
 let k=state.history.slice(-2).join(",");
 let r=state.transitions[k]; if(!r)return null;
 let s=Object.values(r).reduce((a,b)=>a+b,0);
 return Math.round(Math.max(...Object.values(r))/s*100);
}

function predict(){
 if(state.history.length<2)return 1;
 let k=state.history.slice(-2).join(",");
 let r=state.transitions[k]; if(!r)return 1;
 return +Object.keys(r).reduce((a,b)=>r[a]>r[b]?a:b);
}

function getBet(){
 let m=betMode.value;
 let miss=Math.min(state.miss,19);
 if(m==="custom") return state.bets[miss];
 if(m==="martingale") return baseBet.value*(2**miss);
 if(m==="fibonacci") return baseBet.value*fib[miss];
}

function inputNum(n){
 let conf=confidence(),limit=+confLimit.value;
 let bet=getBet(),play=conf&&conf>=limit;

 if(state.lastPrediction!==null && play){
   state.invested+=bet;
   if(state.lastPrediction===n){
     state.correct++;state.miss=0;state.timeline.push(1);
     state.bankroll+=bet;
   }else{
     state.miss++;state.timeline.push(0);
     state.bankroll-=bet;
   }
   state.total++;
   state.bankrollHistory.push(state.bankroll);
 }

 if(state.history.length>=2){
   let k=state.history.slice(-2).join(",");
   state.transitions[k]??={};
   state.transitions[k][n]=(state.transitions[k][n]||0)+1;
 }
 state.history.push(n);
 if(state.history.length>2)state.history.shift();
 state.lastPrediction=predict();
 save();updateUI();updateCharts();
}

function updateUI(){
 let conf=confidence(),limit=+confLimit.value;
 let bet=getBet(),can=conf&&conf>=limit;
 nextPrediction.innerText=state.lastPrediction??"â€”";
 confidence.innerText=conf?`Confidence ${conf}%`:"â€”";
 confidence.className=conf>=60?"green":conf>=40?"yellow":"red";
 nextBet.innerText=can?bet:0;
 betReason.innerText=can?"Panus lubatud":"EI PANUSTA";
 bankroll.innerText=state.bankroll.toFixed(2);
 roi.innerText=state.invested?
 `ROI ${((state.bankroll-startBank.value)/state.invested*100).toFixed(1)}%`:"â€”";
 customTable.style.display=betMode.value==="custom"?"block":"none";
 renderTable();
}

function renderTable(){
 let h="";
 state.bets.forEach((b,i)=>{
 h+=`<tr><td>#${i+1}</td>
 <td><input type=number value=${b} onchange="state.bets[${i}]=this.value;save()"></td>
 <td>${i===state.miss?"â¬…ï¸":""}</td></tr>`;
 });
 betTable.innerHTML=h;
}

function resetAll(){
 let b=state.bets;
 state={history:[],transitions:{},miss:0,lastPrediction:null,
 total:0,correct:0,timeline:[],bankroll:+startBank.value,
 invested:0,bankrollHistory:[],bets:b};
 save();updateUI();updateCharts();
}

function save(){localStorage.setItem("mkv",JSON.stringify(state));}

let acc=new Chart(chartAcc,{type:"line",
 data:{labels:[],datasets:[{data:[],label:"Ã•ige"}]},
 options:{scales:{y:{min:0,max:1}}}});

let bank=new Chart(chartBank,{type:"line",
 data:{labels:[],datasets:[{data:[],label:"Bankroll"}]}});

function updateCharts(){
 acc.data.labels=state.timeline.map((_,i)=>i+1);
 acc.data.datasets[0].data=state.timeline; acc.update();
 bank.data.labels=state.bankrollHistory.map((_,i)=>i+1);
 bank.data.datasets[0].data=state.bankrollHistory; bank.update();
}

updateUI();updateCharts();
<script>
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>
</body>
</html>
